$(document).ready(function(){function o(t=7e3,o=2e4){setTimeout(()=>{$("#changes-saved").show()},t),setTimeout(()=>{$("#changes-saved").hide()},o)}function i(t){$("#loading-notif").show(),$(".form-box").removeClass("highlight"),$.ajax({url:root_url+"api.php?f=retrieve&d="+t,type:"GET",dataType:"json",success:function(t){null==t?$(".detail-container").hide():($(".form-box").find("input#todo-id").val(t.id),$(".form-box").find("input#todo-title").val(t.title),$("textarea#todo-content").siblings(".editor-content").html(t.content),$("#loading-notif").hide(),$(".form-box").addClass("highlight"),$(".form-box button.remove-todo").attr("id",t.id))},error:function(t,o,e){$("#error-notif").show()}})}$.ajax({url:root_url+"api.php?f=retrieve&d=highest_ordering",type:"GET",dataType:"json",success:function(t){null==t?($(".create-container").show(),$(".detail-container").hide()):i(t.id)},error:function(t,o,e){}}),$("#loading-notif").show(),$.ajax({url:root_url+"api.php?f=retrieve&d=all",type:"GET",dataType:"json",success:function(t){var e;$.each(t,function(t,o){e='<li id="'+o.id+'"><a class="link-detail" href="#" data-todo-id="'+o.id+'"><span id="todo'+o.id+'">'+o.title+'</span><img width="12px" src="img/up-arrow.svg"><img width="12px" src="img/down-arrow.svg"></a>',$("#todo-list li:last").after(e)}),$("#todo-list li:nth-child(2)").addClass("active")},complete:function(){$("#loading-notif").hide()},error:function(t,o,e){$("#error-notif").show()}}),$("#todo-list").on("click",".link-detail",function(){$(".create-container").hide(),$(".detail-container").show();var t=$(this).data("todo-id");$("#todo-list li").removeClass("active"),$("li#"+t).addClass("active"),i(t)}),$("#todo-list").sortable({placeholder:"ui-state-highlight",update:function(t,o){var e=new Array;$("#todo-list li").each(function(){e.push($(this).attr("id"))}),$.ajax({url:root_url+"api.php?f=sort&d=all",method:"POST",data:{todo_id_array:e},success:function(t){setTimeout(()=>{$("#reordered-saved").show()},500),setTimeout(()=>{$("#reordered-saved").hide()},3e3)}})}}),$(".create-todo").click(function(t){t.preventDefault(),$(".create-container").show(),$(".detail-container").hide()}),$(".remove-todo").click(function(t){var e;t.preventDefault(),confirm("Are you sure you want to remove the selected TODO?")&&(e=$(".remove-todo").attr("id"),$.ajax({url:root_url+"api.php?f=delete&d="+e,method:"POST",data:{todo_id:e},success:function(t){$("#todo-list li#"+e).remove();var o=$("#todo-list li:nth-child(2)").attr("id");void 0!==o?($(".detail-container").show(),$("li#"+o).addClass("active"),i(o)):setTimeout(function(){location.reload()},500)},error:function(t,o,e){}}))}),$("#form-create-todo").on("click",".create-todo-finish",function(){$.ajax({url:root_url+"api.php?f=create&d=0",type:"POST",data:{title:$("#new-todo-title").val(),content:$("textarea#new-todo-content").siblings(".editor-content").html()},success:function(t){location.reload()},error:function(t,o,e){}})}),$("#todo-title").on("change keyup paste",function(){var t=$("#todo-id").val();$("span#todo"+t).html($("#todo-title").val()),$.ajax({url:root_url+"api.php?f=update&d="+t,type:"POST",data:{id:t,changed_data:{title:$("#todo-title").val()}},success:function(t){o()},error:function(t,o,e){}})}),$("textarea#todo-content").siblings(".editor-content").on("change keyup paste",function(){var t=$("#todo-id").val();$.ajax({url:root_url+"api.php?f=update&d="+t,type:"POST",data:{id:t,changed_data:{content:$("textarea#todo-content").siblings(".editor-content").html()}},success:function(t){o()},error:function(t,o,e){}})})});